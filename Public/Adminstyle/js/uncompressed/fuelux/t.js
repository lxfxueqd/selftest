(function(e,t){var n=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.tree.defaults,n),this.$element.on("click",".tree-item",e.proxy(function(e){this.selectItem(e.currentTarget)},this)),this.$element.on("click",".tree-folder-header",e.proxy(function(e){this.selectFolder(e.currentTarget)},this)),this.render()};n.prototype={constructor:n,render:function(){this.populate(this.$element)},populate:function(t){var n=this,r=t.parent().find(".tree-loader:eq(0)");r.show(),this.options.dataSource.data(t.data(),function(i){r.hide(),e.each(i.data,function(e,r){var i;if(r.type==="folder"){i=n.$element.find(".tree-folder:eq(0)").clone().show(),i.find(".tree-folder-name").html(r.name),i.find(".tree-loader").html(n.options.loadingHTML);var s=i.find(".tree-folder-header");s.data(r),"icon-class"in r&&s.find('[class*="icon-"]').addClass(r["icon-class"])}else r.type==="item"&&(i=n.$element.find(".tree-item:eq(0)").clone().show(),i.find(".tree-item-name").html(r.name),i.data(r));t.hasClass("tree-folder-header")?t.parent().find(".tree-folder-content:eq(0)").append(i):t.append(i)}),n.$element.trigger("loaded")})},selectItem:function(t){if(this.options["selectable"]==0)return;var n=e(t),r=this.$element.find(".tree-selected"),i=[];this.options.multiSelect?e.each(r,function(t,r){var s=e(r);s[0]!==n[0]&&i.push(e(r).data())}):r[0]!==n[0]&&(r.removeClass("tree-selected").find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"]),i.push(n.data())),n.hasClass("tree-selected")?(n.removeClass("tree-selected"),n.find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"])):(n.addClass("tree-selected"),n.find("i").removeClass(this.options["unselected-icon"]).addClass(this.options["selected-icon"]),this.options.multiSelect&&i.push(n.data())),i.length&&this.$element.trigger("selected",{info:i})},selectFolder:function(t){var n=e(t),r=n.parent();n.find("."+this.options["close-icon"]).length?(r.find(".tree-folder-content").children().length?r.find(".tree-folder-content:eq(0)").show():this.populate(n),r.find("."+this.options["close-icon"]+":eq(0)").removeClass(this.options["close-icon"]).addClass(this.options["open-icon"]),this.$element.trigger("opened",n.data())):(this.options.cacheItems?r.find(".tree-folder-content:eq(0)").hide():r.find(".tree-folder-content:eq(0)").empty(),r.find("."+this.options["open-icon"]+":eq(0)").removeClass(this.options["open-icon"]).addClass(this.options["close-icon"]),this.$element.trigger("closed",n.data()))},selectedItems:function(){var t=this.$element.find(".tree-selected"),n=[];return e.each(t,function(t,r){n.push(e(r).data())}),n}},e.fn.tree=function(r,i){var s,o=this.each(function(){var t=e(this),o=t.data("tree"),u=typeof r=="object"&&r;o||t.data("tree",o=new n(this,u)),typeof r=="string"&&(s=o[r](i))});return s===t?o:s},e.fn.tree.defaults={multiSelect:!1,loadingHTML:"<div>Loading...</div>",cacheItems:!0},e.fn.tree.Constructor=n})(window.jQuery)